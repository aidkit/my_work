---

- name: Jenkins Setting Delete
  file: path={{ jenkins_parent_dir }}/jenkins state=absent
  tags:
    - jenkins
    - deploy
    - init_setting
    
- name: アンロック設定済みファイルを配備
  unarchive: src={{ jenkins_initset_file }} dest={{ jenkins_parent_dir }}
  tags:
    - jenkins
    - deploy
    - init_setting

- name: 初期設定済みプロキシファイルを配備
  template: 
    src: jenkins_home/proxy.xml.j2
    dest: /var/lib/jenkins/proxy.xml
    owner: "{{ jenkins_user }}"
    group: "{{ jenkins_user }}"
    mode: 0644
    backup: yes
  tags:
    - jenkins
    - deploy
    - init_setting
    
- name: 初期設定済みシステム設定ファイルを配備
  template: 
    src: jenkins_home/config.xml.j2
    dest: /var/lib/jenkins/config.xml
    owner: "{{ jenkins_user }}"
    group: "{{ jenkins_user }}"
    mode: 0644
    backup: yes
  tags:
    - jenkins
    - deploy
    - init_setting

- name: システム設定関連ファイルを配備
  copy: 
    src: "jenkins_home/{{ item }}"
    dest: /var/lib/jenkins
    owner: "{{ jenkins_user }}"
    group: "{{ jenkins_user }}"
    mode: 0644
    backup: yes
  with_items: "{{ config_files }}"
  tags:
    - jenkins
    - deploy
    - init_setting

- name: Jenkins ワークスペースを生成
  file: 
    path: "{{jenkins_wksp}}"
    state: directory
    owner: "{{ jenkins_user }}"
    group: "{{ jenkins_user }}"
  tags:
    - jenkins
    - deploy
    - init_setting





- name: ReStart jenkins
  service: name=jenkins state=restarted enabled=yes
  tags:
    - jenkins
    - deploy
    - init_setting

- name: Wait for port {{ jenkins_port }} availability
  wait_for: port={{ jenkins_port }} timeout=60
  tags:
    - jenkins
    - deploy
    - init_setting
    
